<div class="container-fluid p-0">
  <div class="bg-white p-3 border-bottom sticky-top shadow-sm" style="top: 0; z-index: 100;">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="d-flex align-items-center gap-3">
        <div class="h5 fw-bold mb-0 text-secondary" style="font-family: 'Poppins', sans-serif;">
          <i class='bx bx-data text-primary'></i> Operatsiyalar
        </div>
        <button class="btn btn-sm btn-light text-primary border shadow-sm rounded-circle"
          onclick="refreshDropdowns(this)" title="Ma'lumotlarni yangilash"
          style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
          <i class='bx bx-refresh fs-5'></i>
        </button>
      </div>

      <button class="btn text-white fw-bold shadow-sm px-4"
        style="background-color: var(--active-color); border: none; transition: all 0.3s ease;"
        onclick="openModal('add')">
        <i class='bx bx-plus-circle'></i> Yangisini qo'shish
      </button>
    </div>

    <div class="btn-group-custom d-flex gap-2">
      <button class="btn-custom active-kirim rounded shadow-sm" onclick="setTransactionType('Kirim', this)">
        KIRIM
      </button>
      <button class="btn-custom rounded shadow-sm" onclick="setTransactionType('Chiqim', this)">
        CHIQIM
      </button>
      <button class="btn-custom rounded shadow-sm" onclick="setTransactionType('Otkazma', this)">
        O'TKAZMA
      </button>
    </div>
  </div>

  <div class="px-3 pt-3">
    <div class="row g-3">
      <div class="col-md-4 col-12">
        <div
          class="bg-white p-3 rounded shadow-sm border-start border-4 border-success d-flex align-items-center justify-content-between">
          <div>
            <div class="text-muted small fw-bold text-uppercase">Naqd Pul (Kassa)</div>
            <div class="h4 mb-0 fw-bold text-dark" id="bal-naqd">Yuklanmoqda...</div>
          </div>
          <div class="bg-light p-3 rounded-circle text-success">
            <i class='bx bx-money fs-3'></i>
          </div>
        </div>
      </div>

      <div class="col-md-4 col-12">
        <div
          class="bg-white p-3 rounded shadow-sm border-start border-4 border-primary d-flex align-items-center justify-content-between">
          <div>
            <div class="text-muted small fw-bold text-uppercase">P2P Hisob</div>
            <div class="h4 mb-0 fw-bold text-dark" id="bal-p2p">Yuklanmoqda...</div>
          </div>
          <div class="bg-light p-3 rounded-circle text-primary">
            <i class='bx bx-credit-card fs-3'></i>
          </div>
        </div>
      </div>

      <div class="col-md-4 col-12">
        <div
          class="bg-white p-3 rounded shadow-sm border-start border-4 border-warning d-flex align-items-center justify-content-between">
          <div>
            <div class="text-muted small fw-bold text-uppercase">Dollar ($)</div>
            <div class="h4 mb-0 fw-bold text-dark" id="bal-dollar">Yuklanmoqda...</div>
          </div>
          <div class="bg-light p-3 rounded-circle text-warning">
            <i class='bx bx-dollar fs-3'></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="p-3">
    <div class="bg-white p-3 rounded shadow-sm border mb-3">
      <div class="row g-2">
        <div class="col-md-4 col-12">
          <label class="small text-muted fw-bold">QIDIRUV</label>
          <div class="input-group">
            <span class="input-group-text bg-light border-end-0"><i class='bx bx-search'></i></span>
            <input type="text" id="filter-search" class="form-control border-start-0"
              placeholder="Savdo nuqtasi,kategoriya yoki summa" onkeyup="renderCurrentView()">
          </div>
        </div>
        <div class="col-md-3 col-6">
          <label class="small text-muted fw-bold">DAN</label>
          <input type="date" id="filter-start" class="form-control" onchange="renderCurrentView()">
        </div>
        <div class="col-md-3 col-6">
          <label class="small text-muted fw-bold">GACHA</label>
          <input type="date" id="filter-end" class="form-control" onchange="renderCurrentView()">
        </div>
        <div class="col-md-2 col-12 d-flex align-items-end">
          <button class="btn btn-light border w-100 fw-bold text-secondary" onclick="resetFilters()">
            <i class='bx bx-reset'></i> CLEAR
          </button>
        </div>
      </div>
    </div>

    <div class="table-responsive bg-white rounded shadow-sm border custom-table-container">
      <table class="table table-hover align-middle mb-0 text-center" id="main-table">
        <thead></thead>
        <tbody id="table-body" class="fw-bold text-secondary">
          <tr>
            <td colspan="11" class="p-4">Ma'lumotlar yuklanmoqda...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal fade" id="transModal" tabindex="-1" data-bs-backdrop="static">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">

      <div class="modal-header text-white py-3" style="background-color: var(--active-color);">
        <h6 class="modal-title fw-bold" id="modalTitle">Tranzaksiya</h6>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body p-4">
        <form id="mainForm" onsubmit="handleFormSubmit(event)">
          <input type="hidden" id="editRowId">
          <input type="hidden" id="formMode" value="add">
          <input type="hidden" id="currentTab" value="Kirim">

          <div class="row g-3 mb-3">
            <div class="col-6">
              <label class="small text-muted fw-bold">SANA</label>
              <input type="date" class="form-control" id="dateInput" required onchange="updateDollarValuation()">
            </div>
            <div class="col-6" id="div-point">
              <label class="small text-muted fw-bold">SAVDO NUQTASI</label>
              <select class="form-select" id="d-point"></select>
            </div>
          </div>

          <div id="form-kirim" style="display:none;">
            <div class="bg-light p-3 rounded border" id="kirim-inputs-container">
              <!-- Dynamic inputs will be generated here -->
              <div class="text-center text-muted small py-2">Yuklanmoqda...</div>
            </div>
            <div class="d-flex justify-content-end align-items-center gap-2 mt-3 px-2 border-top pt-2">
              <span class="fw-bold">JAMI:</span><span class="fw-bold text-success fs-5" id="batch-total">0</span>
            </div>
          </div>

          <div id="form-single" style="display:none;">

            <div id="div-transfer-fields" style="display: none;" class="mb-3">
              <div class="row g-2">
                <div class="col-6">
                  <label class="small text-muted fw-bold text-danger">QAYERDAN</label>
                  <select class="form-select" id="transfer-from" onchange="checkTransferCurrency()"></select>
                </div>
                <div class="col-6">
                  <label class="small text-muted fw-bold text-success">QAYERGA</label>
                  <select class="form-select" id="transfer-to" onchange="checkTransferCurrency()"></select>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label class="small text-muted fw-bold" id="label-amount-main">SUMMA (UZS)</label>
              <input type="number" step="0.01" class="form-control fs-4 fw-bold text-danger" id="single-amount"
                onkeyup="updateDollarValuation()" onchange="updateDollarValuation()">
            </div>

            <div class="mb-3" id="div-second-amount" style="display: none;">
              <label class="small text-muted fw-bold">SUMMA (USD)</label>
              <input type="number" step="0.01" class="form-control fw-bold" id="second-amount">
              <div class="text-danger small fw-bold mt-1">
                <i class='bx bx-info-circle'></i> Summani AQSH dollarida kiriting!
              </div>
            </div>

            <div id="div-cat" class="mb-3">
              <label class="small text-muted fw-bold">KATEGORIYA</label>
              <select class="form-select" id="d-cat"></select>
            </div>
            <div id="div-pay" class="mb-3">
              <label class="small text-muted fw-bold">TO'LOV USULI</label>
              <select class="form-select" id="d-pay" onchange="updateDollarValuation()"></select>
            </div>
          </div>

          <!-- Dollar Rate Warning Box -->
          <div id="dollar-warning-box" class="alert alert-danger mt-2 mb-3 p-2 small border-danger"
            style="display: none; font-size: 11px; background-color: #fef2f2;">
            <div class="d-flex align-items-start gap-2">
              <i class='bx bx-info-circle fs-5 mt-1'></i>
              <div>
                <div id="dollar-conversion-text" class="fw-bold mb-1">
                  "Dollar"dagi "Chiqim" lar Markaziy bank kursi bo'yicha hisoblanadi.
                </div>
                <div id="dollar-conversion-calc" class="fw-bold text-dark fs-6 my-1">
                  Jami summa(UZS): 0 so'm
                </div>
                <div class="text-muted fst-italic">
                  Agar "Chiqim"ni Dollar valyutasida saqlamoqchi bo'lsangiz, bu avtomatik UZS ga o'girib yoziladi.
                  Aks holda "O'tkazma" orqali Dollarni So'mga aylantiring.
                </div>
              </div>
            </div>
          </div>

          <div class="mt-4">
            <label class="small text-muted fw-bold">IZOH</label>
            <input type="text" class="form-control" id="noteInput" placeholder="Izoh qo'shish...">
          </div>

          <button type="submit" class="btn btn-primary w-100 mt-4 btn-save py-2 fw-bold shadow-sm"
            style="background-color: var(--active-color); border:none;">
            SAQLASH
          </button>
        </form>
      </div>
    </div>
  </div>
</div>